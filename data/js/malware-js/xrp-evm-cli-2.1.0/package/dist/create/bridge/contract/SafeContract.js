"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildSentinel = exports.XrpSafeContract = exports.XrpSafeContractAddress = void 0;
const StorageHelpers_1 = require("./StorageHelpers");
const safe_contracts_json_1 = __importDefault(require("./safe-contracts.json"));
const BridgeDoorContract_1 = require("./BridgeDoorContract");
const keccak256_1 = __importDefault(require("keccak256"));
exports.XrpSafeContractAddress = `0x${(0, keccak256_1.default)(Buffer.from("xrp_bridge")).slice(-20).toString("hex")}`;
const XrpSafeContract = (owners, threshold) => ({
    address: exports.XrpSafeContractAddress,
    bytecode: "608060405273ffffffffffffffffffffffffffffffffffffffff600054167fa619486e0000000000000000000000000000000000000000000000000000000060003514156050578060005260206000f35b3660008037600080366000845af43d6000803e60008114156070573d6000fd5b3d6000f3fea2646970667358221220d1429297349653a4918076d650332de1a1068c5f3e07c5c82360c277770b955264736f6c63430007060033",
    memory: buildSafeStorage(owners, threshold, [BridgeDoorContract_1.BridgeDoorContractAddress]),
});
exports.XrpSafeContract = XrpSafeContract;
const buildSentinel = (addresses) => {
    const sentinel = "0x0000000000000000000000000000000000000001";
    let currentOwner = sentinel;
    const result = {};
    for (let i = 0; i < addresses.length; i++) {
        result[currentOwner] = addresses[i];
        currentOwner = addresses[i];
    }
    result[currentOwner] = sentinel;
    return result;
};
exports.buildSentinel = buildSentinel;
const buildSafeStorage = (owners, threshold, modules) => {
    const safeMasterAddress = safe_contracts_json_1.default.find((contract) => contract.name === "GnosisSafeL2").address;
    const fallbackHandlerAddress = safe_contracts_json_1.default.find((contract) => contract.name === "CompatibilityFallbackHandler").address;
    return [
        ...(0, StorageHelpers_1.buildStorage)({
            slot: 0,
            value: safeMasterAddress,
        }),
        ...(0, StorageHelpers_1.buildStorage)({
            slot: 1,
            value: (0, exports.buildSentinel)(modules),
        }),
        ...(0, StorageHelpers_1.buildStorage)({
            slot: 2,
            value: (0, exports.buildSentinel)(owners),
        }),
        ...(0, StorageHelpers_1.buildStorage)({
            slot: 3,
            value: owners.length,
        }),
        ...(0, StorageHelpers_1.buildStorage)({
            slot: 4,
            value: threshold,
        }),
        ...(0, StorageHelpers_1.buildStorage)({
            slot: "6c9a6c4a39284e37ed1cf53d337577d14212a4870fb976a4366c693b939918d5",
            value: fallbackHandlerAddress,
        }),
    ];
};
//# sourceMappingURL=SafeContract.js.map